# Gateway API Chart - Values Configuration
#
# This chart deploys Gateway API resources for GKE, including:
# - Gateway and HTTPRoute resources
# - ServiceExport (multi-cluster) or Service (single-cluster) configurations
# - GCP-specific policies (Gateway Policy, Backend Policy, Health Check Policy)
# - Cloud Armor WAF security policies (requires Config Connector)
#
# PRIMARY USE CASE: This chart is designed as a dependency chart for exposing
# regular Kubernetes Services via Gateway API instead of Ingress.
#
# For detailed documentation, see: https://github.com/PurseChicken/helm-charts/tree/main/charts/gateway-api-chart
#
# ==============================================================================
# GATEWAY CONFIGURATION
# ==============================================================================
# Deploy a Gateway
# gateway:
#   - name: my-gw
#     # Optional: Namespace for the Gateway (defaults to Release.Namespace if not specified)
#     # For dependency charts, typically leave this unset to deploy to parent chart's namespace
#     # For shared Gateways, you might use a dedicated namespace like "gateway-system"
#     # namespace: gateway-system
#     # If you use cert-manager, you can specify the issuer type and name here
#     issuer:
#       type: cluster-issuer
#       name: my-cluster-issuer
#     # REQUIRED: Gateway class name
#     # GKE options: https://cloud.google.com/kubernetes-engine/docs/how-to/gatewayclass-capabilities
#     # Common classes:
#     #   - gke-l7-global-external-managed-mc (Global external, multi-cluster)
#     #   - gke-l7-regional-external-managed-mc (Regional external, multi-cluster)
#     gatewayClassName: gke-l7-global-external-managed-mc
#     listeners:
#       # toYaml
#       - name: https
#         hostname: my.host.name
#         port: 443
#         protocol: HTTPS
#         allowedRoutes:
#           kinds:
#             - kind: HTTPRoute
#         tls:
#           mode: Terminate
#           certificateRefs:
#             - name: my-cert
#     # Configure Gateway Policy (GCPGatewayPolicy resource)
#     # ⚠️  GKE-SPECIFIC: GCPGatewayPolicy MUST be in the same namespace as the Gateway
#     # If Gateway has a namespace specified, the policy will be deployed to that namespace
#     # All fields are optional
#     gatewayPolicy:
#       # Allow global access to the Gateway (default: false)
#       # See: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#configure_global_access
#       allowGlobalAccess: false
#       # SSL Policy name (must already exist in GCP)
#       # See: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#configure_ssl_policies
#       # sslPolicy: my-modern-policy
#       # Region for multi-cluster regional Gateways
#       # Requires: GKE 1.30.3+
#       # If not specified, defaults to the config cluster's region
#       # region: us-central1

# ==============================================================================
# HTTP ROUTE CONFIGURATION
# ==============================================================================
# Deploy an HTTPRoute and attach to a gateway.
# httpRoute:
#   - name: my-route
#     # What is the name of the Gateway this httpRoute should attach to?
#     gatewayName: my-gw
#     # Is the gateway you are referencing in a different namespace than where this httpRoute will be deployed? If so specify here.
#     gatewayNamespace: my-different-namespace
#     # Do you want to automatically add a httpRoute to redirect HTTP requests to HTTP?
#     # This will add a HTTPRoute which will attach to the gateway that will instruct it to redirect to the HTTPS scheme. An HTTP listener must exist on the gateway.
#     redirectHTTP:
#       # What is the name of the http listener?
#       httpListenerName: http
#     # You can also redirect specific hostnames to other hostnames.
#     # This creates 1 or more httpRoutes which redirect requests to the listenerName to the redirectHostname.
#     redirectHost:
#       # The listenerName must exist on the gatewayName referenced above.
#       - listenerName: http-www
#         # What scheme should be used when the redirect occurs?
#         redirectScheme: https
#         # What is the hostname you want to redirect to?
#         redirectHostname: nonwww.host
#       - listenerName: http-non-www
#         redirectScheme: https
#         redirectHostname: www.host.name
#     rules:
#       # toYaml see: https://gateway-api.sigs.k8s.io/reference/spec/#gateway.networking.k8s.io/v1.HTTPRouteRule
#       - backendRefs:
#         - group: net.gke.io
#           kind: ServiceImport
#           name: my-service
#           port: 8080

# ==============================================================================
# SERVICE EXPORT CONFIGURATION (Multi-Cluster Only)
# ==============================================================================
# Deploy ServiceExport for Multi-Cluster-Ingress (ServiceImport)
#
# ⚠️  USE THIS ONLY FOR MULTI-CLUSTER SCENARIOS
# Use this section ONLY when you need to export a service for cross-cluster access
# via ServiceImport. For single-cluster deployments with regular Kubernetes Services,
# use the "service" section instead (see below).
#
# GKE-SPECIFIC REQUIREMENTS:
# - BackendPolicy and HealthCheckPolicy MUST be in the same namespace as the ServiceImport
# - For dependency charts, resources deploy to Release.Namespace (parent chart's namespace)
# - ServiceImport resources are created by GKE when ServiceExport is deployed
# serviceExport:
#   # Name should match the service name that you want to "export". For example, your service name might be my-service. Thats what you want to specify here.
#   - name: my-service
#     # Note: Resources deploy to Release.Namespace (the namespace where parent chart is installed)
#     # Optional: Override targetRef for BackendPolicy and HealthCheckPolicy
#     # Defaults to group: "net.gke.io", kind: "ServiceImport" if not specified
#     # Only specify namespace in targetRef if the ServiceImport is in a different namespace
#     # targetRef:
#     #   group: net.gke.io  # Optional, defaults to "net.gke.io"
#     #   kind: ServiceImport  # Optional, defaults to "ServiceImport"
#     #   namespace: other-namespace  # Only specify if ServiceImport is in different namespace
#     # Configure custom health checks for this service endpoint
#     # See: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#configure_health_check
#     # The healthcheck policy name is derived from the service name (e.g., my-service-healthcheck)
#     # All fields below are optional and have defaults as shown
#     healthCheck:
#       # Optionally configure the below defaults. If not specified, the default values listed will be used.
#       checkIntervalSec: 15
#       timeoutSec: 15
#       healthyThreshold: 1
#       unhealthyThreshold: 2
#       logConfigEnabled: true
#       # REQUIRED: Health check type
#       # Options: HTTP, HTTPS, TCP, GRPC, HTTP2
#       type: HTTP
#       # Configure the health check based on type:
#       # - HTTP: use httpHealthCheck
#       # - HTTPS: use httpsHealthCheck
#       # - TCP: use tcpHealthCheck (or leave empty for default)
#       # - GRPC: use grpcHealthCheck
#       # - HTTP2: use http2HealthCheck
#       httpHealthCheck:
#         # toYaml
#         requestPath: "/healthz"
#     # Configure backend policy settings (GCPBackendPolicy resource)
#     # All fields are optional - only specify what you need to customize
#     backendPolicy:
#       # Request timeout in seconds
#       # See: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#configure_timeout
#       timeoutSec: 40
#       # Session Affinity: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#session_affinity
#       sessionAffinity:
#         # CLIENT_IP or GENERATED_COOKIE
#         type: GENERATED_COOKIE
#         # If GENERATED_COOKIE Specify TTL
#         cookieTtlSec: 50
#       # Connection Draining: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#configure_connection_draining
#       connectionDraining:
#         timeoutSec: 60
#       # Logging: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#http_access_logging
#       logging:
#         enabled: true
#         sampleRate: 500000
#         # Optional: Configure optional fields to log (GKE-specific)
#         # optionalMode: CUSTOM  # CUSTOM or EXCLUDE_ALL_OPTIONAL
#         # optionalFields:
#         #   - tls.cipher
#         #   - orca_load_report.cpu_utilization
#       # Traffic-based autoscaling: Maximum requests per second per endpoint
#       # Requires: GKE 1.31.1+
#       # See: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#traffic-based-autoscaling
#       # maxRatePerEndpoint: 10
#       # Backend selection with custom metrics
#       # Requires: GKE 1.33+
#       # See: https://cloud.google.com/kubernetes-engine/docs/how-to/configure-gateway-resources#backend-selection
#       # backends:
#       #   - location: "*"
#       #     balancingMode: RATE
#       #     maxRatePerEndpoint: 9000
#       #   - location: us-central1-a
#       #     balancingMode: CUSTOM_METRICS
#       #     customMetrics:
#       #       - name: gpu-load
#       #         maxUtilization: 100
#       #         dryRun: false
#       # Identity-Aware Proxy (IAP) configuration
#       # See: https://cloud.google.com/iap/docs/enabling-kubernetes-howto
#       # iap:
#       #   enabled: true
#       #   clientID: YOUR_CLIENT_ID
#       #   oauth2ClientSecret:
#       #     name: iap-secret-name
#       # Configure WAF (Cloud Armor) Security Policy
#       # ⚠️  REQUIRES: Config Connector add-on enabled on your GKE cluster
#       # See: https://cloud.google.com/config-connector/docs/overview
#       securityPolicy:
#         # Enable/disable this security policy
#         # Set to false to disable without removing configuration (useful for testing)
#         enabled: true
#         # Optional description for the security policy (max 2048 characters)
#         # If not specified, defaults to "Cloud Armor WAF policy for <service-name>"
#         # description: "WAF policy for production API endpoints"
#         # Enable Adaptive Protection on this Security Policy? https://cloud.google.com/armor/docs/adaptive-protection-overview
#         # enableAdaptiveProtection: true
#         # By default the action for all the rules is "deny(403)" However if you want to specify your own action you can do so here:
#         action: "deny(403)"
#         # Should the rules be in preview mode? Meaning that they log but don't take action? Setting preview to false puts all rules in enforcement mode.
#         # https://cloud.google.com/armor/docs/security-policy-overview#preview_mode
#         preview: false
#         # REQUIRED: GCP project ID where the security policy will be created
#         project: my-gcp-project
#         # WAF Rules are grouped into "waves" to minimize rule quota usage.
#         # Each wave combines multiple WAF rule sets into a single rule using OR operators.
#         # This approach reduces the total number of rules from 12+ to just 3-4 rules.
#         # Wave priorities: 5 (highest), 10, 15 (lowest) - evaluated before default allow rule.
#         # Wave 1: SQL Injection, XSS, LFI, RCE, RFI rules - Core injection attacks
#         # Wave 2: Method Enforcement, Scanner Detection, Protocol Attack, PHP, Session Fixation rules - Protocol and method-based attacks
#         # Wave 3: Java, NodeJS, CVE, JSON SQLi rules - Language-specific and vulnerability-based attacks
#         # The below is only documented \ commented for the SQL Injection Rules, however the same sensitivity and optOut and optIn Rule configuration can be applied to all the preconfigured WAF Rules
#         # If you leave out a section entirely, then those WAF rules will not apply at all.
#         # Alternatively, you can set enabled: false to disable a rule set without removing the config block.
#         # Configure SQL Injection Rules: https://cloud.google.com/armor/docs/waf-rules#sql_injection_sqli
#         sqliConfig:
#           # Set enabled: false to disable this rule set without removing the config block
#           # If enabled is not specified, defaults to true (backwards compatible)
#           # Specify a Sensitivity level that you want to apply: https://cloud.google.com/armor/docs/rule-tuning#choose_a_sensitivity_level
#           sensitivity: 1
#           # Specify which signatures you want to not apply. https://cloud.google.com/armor/docs/rule-tuning#opt_out_rule_signatures
#           optOutRules:
#             - "owasp-crs-v030301-id942440-sqli"
#           # Specify which signatures you want to optIn to. If you specify optOutRules you cannot specify optInRules. You must also set sensitivity to 0. https://cloud.google.com/armor/docs/rule-tuning#opt_in_rule_signatures
#           optInRules:
#             - "owasp-crs-v030301-id942440-sqli"
#         # Cross Site Scripting Rules: https://cloud.google.com/armor/docs/waf-rules#cross-site_scripting_xss
#         xssConfig:
#           # Set enabled: false to disable this rule set without removing the config block
#           # If enabled is not specified, defaults to true
#           enabled: true
#         # Local File Inclusion Rules: https://cloud.google.com/armor/docs/waf-rules#local_file_inclusion_lfi
#         lfiConfig:
#           # Set enabled: false to disable without removing the config block
#           enabled: true
#         # Remote Code Execution Rules: https://cloud.google.com/armor/docs/waf-rules#remote_code_execution_rce
#         rceConfig:
#           enabled: true
#         # Remote File Inclusion Rules: https://cloud.google.com/armor/docs/waf-rules#remote_file_inclusion_rfi
#         rfiConfig:
#           enabled: true
#         # Method Enforcement Rules: https://cloud.google.com/armor/docs/waf-rules#method_enforcement
#         methodConfig:
#           enabled: true
#         # Scanner Detection Rules: https://cloud.google.com/armor/docs/waf-rules#scanner_detection
#         scannerConfig:
#           enabled: true
#         # Protocol Attack Rules: https://cloud.google.com/armor/docs/waf-rules#protocol_attack
#         protocolConfig:
#           enabled: true
#         # PHP Rules: https://cloud.google.com/armor/docs/waf-rules#php
#         phpConfig:
#           enabled: true
#         # Session Fixation Rules: https://cloud.google.com/armor/docs/waf-rules#session_fixation
#         sessionConfig:
#           enabled: true
#         # Java Attack Rules: https://cloud.google.com/armor/docs/waf-rules#java_attack
#         javaConfig:
#           enabled: true
#         # NodeJS Attack Rules: https://cloud.google.com/armor/docs/waf-rules#nodejs_attack
#         nodejsConfig:
#           enabled: true
#         # CVE and Other Vulnerability Rules: https://cloud.google.com/armor/docs/waf-rules#cves_and_other_vulnerabilities
#         cveConfig:
#           # Example: Set enabled: false to disable CVE rules
#           enabled: true
#         # JSON-formatted content SQLi vulnerability: https://cloud.google.com/armor/docs/waf-rules#json-formatted_content_sqli_vulnerability
#         jsonsqliConfig:
#           enabled: true
#         # Set a default rate limit ban or throttling
#         # Rate limiting rule is applied just before default allow rule (priority 2147483646)
#         rateLimitConfig:
#           # rate_based_ban or throttle
#           # throttle can be changed to rate_based_ban but not rate_based_ban to throttle
#           action: "rate_based_ban"
#           preview: true
#           # how long should the ban be in affect for? Ignored if action set to throttle
#           banDurationSec: 60
#           # When the rate limit is exceeded what code should be returned to the client?
#           # deny-403|deny-404|deny-429|deny-502|redirect
#           exceedAction: deny(429)
#           # How many requests should be exceeded during the time interval to ban or throttle?
#           requests: 100
#           # Time interval in seconds
#           interval: 60
#           # Use only one of enforceOnKey or enforceOnKeyConfigs (not both)
#           # Optional. Define which key(s) you want to use for rate limiting. Defaults to "ALL"
#           # See: https://cloud.google.com/armor/docs/rate-limiting-overview#identifying_clients_for_rate_limiting
#           # 
#           # Option 1: Simple enforceOnKey (single key)
#           # enforceOnKey: "XFF_IP"  # Options: ALL, IP, XFF_IP, HTTP_HEADER, HTTP_COOKIE
#           # enforceOnKeyName: "MY_COOKIE"  # Required when using HTTP_HEADER or HTTP_COOKIE
#           #
#           # Option 2: Multiple keys using enforceOnKeyConfigs (GKE 1.30+)
#           # Note: When using enforceOnKeyConfigs, enforceOnKey must be empty (handled automatically)
#           # enforceOnKeyConfigs:
#           #   - keyType: "IP"
#           #   - keyType: "HTTP_COOKIE"
#           #     keyName: "SESSION_ID"  # Required when keyType is HTTP_HEADER or HTTP_COOKIE
#           #   - keyType: "HTTP_HEADER"
#           #     keyName: "X-Forwarded-For"
#         # Custom Rules. This can be any rule(s) you want to create yourself (passed through as-is):
#         customRules:
#           # toYaml
#           - description: "my-custom-rule"
#             action: deny(403)
#             preview: true
#             priority: 99
#             match:
#               expr:
#                 # Specify the expression. Here are some examples: https://cloud.google.com/armor/docs/rules-language-reference#expression-examples
#                 expression: "inIpRange(origin.ip, '198.51.100.0/24')"

# ==============================================================================
# SERVICE CONFIGURATION (Primary Use Case - Single Cluster)
# ==============================================================================
# Deploy backend policies for regular Kubernetes Services
#
# ✅ PRIMARY USE CASE: This is the recommended section for dependency charts.
# Use this when deploying as a dependency chart where you have a regular Kubernetes
# Service and want to expose it via Gateway API instead of Ingress.
#
# Example: Exposing argo-cd, prometheus, or any standard Kubernetes application
# that only supports Ingress - include this chart as a dependency to use Gateway API.
#
# GKE-SPECIFIC REQUIREMENTS:
# - BackendPolicy and HealthCheckPolicy MUST be in the same namespace as the Service
# - For dependency charts, resources deploy to Release.Namespace (parent chart's namespace)
# - The Service itself must already exist (this chart only creates policies, not the Service)
# service:
#   - name: my-service
#     # Note: Resources deploy to Release.Namespace (the namespace where parent chart is installed)
#     # Optional: Override targetRef for BackendPolicy and HealthCheckPolicy
#     # Defaults to group: "" (empty, which means core v1), kind: "Service" if not specified
#     # Only specify namespace in targetRef if the Service is in a different namespace
#     # targetRef:
#     #   group: ""  # Optional, defaults to "" (core v1 API)
#     #   kind: Service  # Optional, defaults to "Service"
#     #   namespace: other-namespace  # Only specify if Service is in different namespace
#     # Configure custom health checks for this service endpoint
#     # See serviceExport.healthCheck section above for detailed documentation
#     # All fields are optional with defaults: checkIntervalSec=15, timeoutSec=15, etc.
#     healthCheck:
#       type: HTTP  # Options: HTTP, HTTPS, TCP, GRPC, HTTP2
#       httpHealthCheck:
#         requestPath: "/healthz"
#     # Configure backend policy settings (GCPBackendPolicy resource)
#     # See serviceExport.backendPolicy section above for detailed documentation
#     # All fields are optional - only specify what you need to customize
#     backendPolicy:
#     #   timeoutSec: 40
#     #   sessionAffinity:
#     #     type: GENERATED_COOKIE
#     #     cookieTtlSec: 50
#     #   connectionDraining:
#     #     timeoutSec: 60
#     #   logging:
#     #     enabled: true
#     #     sampleRate: 500000
#     #     # Optional: Configure optional fields to log
#     #     # optionalMode: CUSTOM
#     #     # optionalFields:
#     #     #   - tls.cipher
#     #   # Traffic-based autoscaling: Maximum requests per second per endpoint (GKE 1.31.1+)
#     #   # maxRatePerEndpoint: 10
#     #   # Backend selection with custom metrics (GKE 1.33+)
#     #   # backends:
#     #   #   - location: "*"
#     #   #     balancingMode: RATE
#     #   #     maxRatePerEndpoint: 9000
#     #   # Identity-Aware Proxy (IAP) configuration
#     #   # iap:
#     #   #   enabled: true
#     #   #   clientID: YOUR_CLIENT_ID
#     #   #   oauth2ClientSecret:
#     #   #     name: iap-secret-name
#       # Configure WAF (Cloud Armor) Security Policy
#       # ⚠️  REQUIRES: Config Connector add-on enabled on your GKE cluster
#       # See serviceExport.backendPolicy.securityPolicy section above for complete documentation
#       securityPolicy:
#         enabled: true
#         project: my-gcp-project  # REQUIRED: GCP project ID
#         # WAF rule configuration - see serviceExport section for all available options
#         sqliConfig:
#           sensitivity: 1